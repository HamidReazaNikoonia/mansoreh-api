<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link href="<%=server%>/static/css/bootstrap.css" rel="stylesheet">
	<link href="<%=server%>/static/css/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">

    <title>Invoce</title>

    <!-- Bootstrap core CSS-->
    <!-- <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet"> -->

    <!-- Custom fonts for this template-->
    <!-- <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css"> -->

    <!-- Page level plugin CSS-->
    <!-- <link href="vendor/datatables/dataTables.bootstrap4.css" rel="stylesheet"> -->

    <!-- Custom styles for this template-->
    <link href="<%=server%>/static/css/sb-admin.css" rel="stylesheet">

    <style type="text/css">


		body {

		}
		

		#invoice{
    padding: 30px;
}

	.invoice {
    
    background-color: #FFF;
    /*min-height: 680px;*/
    padding: 15px
}

.invoice header {
    padding: 10px 0;
    margin-bottom: 20px;
    border-bottom: 1px solid #3989c6
}

.invoice .company-details {
    text-align: right
}

.invoice .company-details .name {
    margin-top: 0;
    margin-bottom: 0
}

.invoice .contacts {
    margin-bottom: 20px
}

.invoice .invoice-to {
    text-align: left
}

.invoice .invoice-to .to {
    margin-top: 0;
    margin-bottom: 0
}

.invoice .invoice-details {
    text-align: right
}

.invoice-details span {
    color: gray;
}

.invoice .invoice-details .invoice-id {
    margin-top: 0;
    color: #3989c6;
    font-size: 1rem;
}

.invoice main {
    padding-bottom: 50px
}

.invoice main .thanks {
    font-size: 2em;
    margin-bottom: 50px
}

.invoice main .notices {
    padding-left: 6px;
    border-left: 6px solid #3989c6
}

.invoice main .notices .notice {
    font-size: 1.2em
}

.invoice table {
    width: 100%;
    border-collapse: collapse;
    border-spacing: 0;
    margin-bottom: 20px
}

.invoice table td,.invoice table th {
    padding: 15px;
    background: #eee;
    border-bottom: 1px solid #fff
}

.invoice table th {
    white-space: nowrap;
    font-weight: 400;
    font-size: 16px
}

.invoice table td h3 {
    margin: 0;
    font-weight: 400;
    color: #3989c6;
    font-size: 1.2em
}

.invoice table .qty,.invoice table .total,.invoice table .unit {
    text-align: right;
    font-size: 1.2em
}

.invoice table .no {
    color: #fff;
    font-size: 1.6em;
    background: #3989c6
}

.invoice table .unit {
    background: #ddd;
    text-align:center;
}

.invoice table .total {
    background: #3989c6;
    color: #fff
}

.invoice table tbody tr:last-child td {
    border: none
}

#tfoot ul {
    display:block;
    list-style: none;
}

#tfoot li {
    background: 0 0;
    border-bottom: none;
    white-space: nowrap;
    text-align: right;
    padding: 10px 20px;
    font-size: 1.2em;
    border-top: 1px solid #aaa
}

 #tfoot ul:first-child li {
    border-top: none
}

 #tfoot ul:last-child li {
    color: #3989c6;
    font-size: 1.4em;
    border-top: 1px solid #3989c6
}

 #tfoot ul li:first-child {
    border: none
}

.invoice footer {
    width: 100%;
    text-align: center;
    color: #777;
    border-top: 1px solid #aaa;
    padding: 8px 0
}

@media print {
    .invoice {
        font-size: 11px!important;
        overflow: hidden!important
    }

    .invoice footer {
        position: absolute;
        bottom: 10px;
        page-break-after: always
    }

    .invoice>div:last-child {
        page-break-before: always
    }
}

tbody tr td  {
	text-align: center;
	
}

/*.submit_btn , input[type="submit"]{
	display: none;
}*/


	</style>

  </head>

  <body id="page-top">

     <%- include('layout/header')  %>


    <div id="wrapper">

      <!-- Sidebar -->
      <%-   include('layout/side_bar')  %>

      <div id="content-wrapper">

        <div class="container-fluid">

          <!-- Breadcrumbs-->
          <ol class="breadcrumb">
            <li class="breadcrumb-item">
              <a href="{{ url('/admin') }}">Dashboard</a>
            </li>
            <li class="breadcrumb-item active">Service Details</li>
          </ol>

          <!-- Page Content -->
          <h1>Service Information</h1>
          <hr>
          <!--<p></p> -->

          <div class="row">
          	<div class="col-12">
<div id="invoice">

    <div class="toolbar hidden-print">
        <div class="text-right">
            <button id="printInvoice" class="btn btn-info"><i class="fa fa-print"></i> Print</button>
            <button class="btn btn-info"><i class="fa fa-file-pdf-o"></i> Export as PDF</button>
        </div>
        <hr>
    </div>
    <div class="invoice overflow-auto">
        <div style="min-width: 350px">
            <header>
                <div class="row">
                    <div class="col">
                            <h1 style="padding-top:20px"><%= appName  %></h1>
                    </div>
                    <div class="col pb-5 company-details">
                        
                    </div>
                </div>
            </header>
            <main>
                <div class="row contacts">
                    <div class="col invoice-to">
                        <div class="text-gray-light">INVOICE TO:</div>
                        <h2 class="to">
                           <%= service.name  %>
                        </h2>

                        <div style="color:gray;padding-left:10px" class="address">
                             <%= service.name  %>  <%= service.family  %>
                         </div>

                        <div class="email">
                        	<a href="mailto:{{ $n->email }}">
                               <%= service.email  %>
                            </a>
                        </div>

                        <div class="mobile">
                        	<a href="tel:{{ $n->mobile }}">
                               <%= service.mobile  %>
                            </a>
                        </div>
                    </div>


                    <div class="col invoice-details" style="text-align: left;">
                        <h1 class="invoice-id"><span>INVOICE</span> : <%= service.invoice_id  %></h1>
                        <div class="date"><span>Date of Invoice</span> : <%= service.createdAt.toLocaleString()  %></div>
                        <div class="date"><span>Last Update</span> : <%= service.updatedAt.toLocaleString()  %></div>
                    </div>


                </div>
                <div class="row">
                <div class="col-md-12">
                  <table border="0" cellspacing="0" cellpadding="0">
                    <thead>
                        <tr>
                            <th></th>
                            <th class="text-left">Order Information</th>
                            
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="text-left"><h3>
                                User Name
                                </h3>
                            </td>
                            <td class="unit"><%= service.name  %></td>
                            
                        </tr>
                        <tr>
                            <td class="text-left">User Family</td>
                            <td class="unit"><%= service.family  %></td>
                          
                        </tr>
                        <tr>
                            <td class="text-left">User Email</td>
                            <td class="unit"><%= service.email  %></td>
                            
                        </tr>
                        <tr>
                            <td class="text-left">User Telegram Id</td>
                            <td class="unit"><%= service.telegram  %></td>
                            
                        </tr>

                          <tr>
                            <td class="text-left">User Mobile</td>
                            <td class="unit"><%= service.mobile  %></td>
                            
                        </tr>
                          <tr>
                            <td class="text-left">Category</td>
                            <td class="unit"><%= service.service_kind  %></td>
                            
                        </tr>
                          <tr>
                            <td class="text-left">Evidence</td>
                            <td class="unit"><%= service.service_type  %></td>
                            
                        </tr>
                          <tr>
                            <td class="text-left">end Result By</td>
                            <td class="unit"><%= service.send_via  %></td>
                            
                        </tr>
                          <tr>
                            <td class="text-left">Payment</td>
                            <td class="unit"><%= service.payment_status ? "done" : "none"  %></td>
                            
                        </tr>
                          <tr>
                            <td class="text-left">Send Notification</td>
                            <td class="unit"><%= service.call_to_user ? "done" : "none"  %></td>
                            
                        </tr>
                          <tr>
                            <td class="text-left">Payment Ref</td>
                            <td class="unit"></td>
                        </tr>
                        <tr>
                            <td class="text-left">Price</td>
                            <td class="unit"><%= service.price  %> Rial</td>
                        </tr>

                          <tr>
                            <td class="text-left">File</td>
                            <td class="unit"> 
                            <button class="btn btn-primary ">
                            	<a style="color:white" download  href="<%= server %>/file/<%=  service.service_file ? service.service_file.file_name : ''  %>" >download file</a>
                                </button>
                            </td>
                        </tr>
                          <tr>
                            <td class="text-left">Result</td>
                            <td class="unit">
                            	<form
                                enctype="multipart/form-data"
                                 id="upload_">
                            		<div style='height: 0px;width:0px; overflow:hidden;'>
                            			<input id="upfile" name="singleFile" type="file"/>
                            		</div>
                            		<div id="uploadHandler" class="btn btn-primary"> Upload Result </div>
                            		<input class="btn btn-secondary submit_btn" type="submit" value=" Send File">
                            	</form>

                                <%  if(service.service_result && service.service_result !== "") {  %>
								 
                                     <button style="margin-top:20px" class="btn btn-primary ">
                            	<a style="color:white" download  href="<%= server %>/file/<%= service.service_result.file_name ? service.service_result.file_name : ''  %>" >download file</a>
                                </button>

                                <% } %>
                            </td>
                        </tr>
                    </tbody>
                </table>
                </div>

                <div class="col-md-12" style="padding-top:100px">
                 <div id="tfoot">
                        <ul>
                            <li colspan="2">SUBTOTAL</li>
                            <li><%= service.price  %> Rial</li>
                        </ul>
                        
                        <ul>
                            <li colspan="2">GRAND TOTAL</li>
                            <li><%= service.price %> Rial</li>
                        </ul>
                    </div>
                </div>

                </div>
                <div class="thanks"></div>
                <div class="notices">
                    <div>User Details:</div>
                    <div class="notice"> <%= service.details  %> </div>
                </div>

                <div class="pt-5 mt-3">
                	<div class="jumbotron">
                		<div id="sned_user" class="text-center btn btn-info w-100">Send Result To User</div>
                		

                		<%	 if(service.call_to_user) {  %>
                				<span style='text-align:right;color:red'><i> sended before </i></span>
                		<%	}  %>

                	</div>
                </div>
            </main>
            <footer>
                Invoice was created on a computer and is valid without the signature and seal.
            </footer>
        </div>
        <!--DO NOT DELETE THIS div. IT is responsible for showing footer always at the bottom-->
        <div></div>
    </div>
</div>
                </table>
          	</div>
          </div>

        </div>
        <!-- /.container-fluid -->

        <!-- Sticky Footer -->
        <footer class="sticky-footer">
          <div class="container my-auto">
            <div class="copyright text-center my-auto">
              <span>Copyright © Your Website 2018</span>
            </div>
          </div>
        </footer>

      </div>
      <!-- /.content-wrapper -->

    </div>
    <!-- /#wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
      <i class="fas fa-angle-up"></i>
    </a>

    <!-- Logout Modal-->
    <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
            <button class="close" type="button" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">×</span>
            </button>
          </div>
          <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
          <div class="modal-footer">
            <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
            <a class="btn btn-primary" href="login.html">Logout</a>
          </div>
        </div>
      </div>
    </div>

    <script src="<%=server%>/static/js/jquery.min.js"></script>
	<script src="<%=server%>/static/js/bootstrap.bundle.min.js"></script>
	<script src="<%=server%>/static/js/jquery.dataTables.min.js"></script>

    <!-- Bootstrap core JavaScript-->
    <!--<script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
     <script src="vendor/jquery-easing/jquery.easing.min.js"></script> -->

    <!-- Custom scripts for all pages-->
    <script src="<%=server%>/static/js/sb-admin.js"></script>
    <script type="text/javascript">

    	// $.ajaxSetup({
    	// 			headers: {
        // 				'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
    	// 			}
		// 		}); 


    	window.uploaded_file = '';

    	function update_data(file_id) {
    		var data = {
    			data: {
                    service_result: file_id
                },
    			id:'<%= service._id %>'
    		}
    		 $.ajax({
    		 	url: '<%server%>/v1/services',
				type: 'PUT',              
				data: data,
				success: function (data) {
					console.log(data);
					document.location.reload(true)

				},
				error: function(err) {
					console.log(err);
				}

    		 })
    	}

        $('#uploadHandler').click(function(e) {
			document.getElementById("upfile").click();
		})


    	$("#sned_user").click(function() {

    		var id_ = {
    			id: '<%=service._id%>'
    		}

    		  $.ajax({
		        url: `<%=server%>/dashboard/service/send_result/${id_.id}`,
		        type: 'POST',              
		        data: {},
		        success: function(result)
		        {
		            console.log('success');
		             console.log(result);
                     alert('result sended successfully');
                     document.location.reload(true);

		             // please upload result first
		             if(result.error) {
		             	alert(result.error);
		             	return false;
		             }

		             
		        },
		        error: function(data)
		        {
		            console.log(data);
		            alert("some thing wrong , please try again");
		        }
		    });
    	});

    	 $('#printInvoice').click(function(){
            Popup($('.invoice')[0].outerHTML);
            function Popup(data) 
            {
                window.print();
                return true;
            }
        });

    	 				$('#upload_').submit(function(event) {
    					event.preventDefault();
    					var formData = new FormData($("#upload_")[0]);
    			
		    			
						    $.ajax({
						        url: '<% server %>/upload',
						        type: 'POST',              
						        data: formData,
						  		processData: false,
						  		contentType: false,
						        success: function(result)
						        {
						            console.log('success');
						             window.uploaded_file = result;
						             console.log(result.uploadedFile._id);
						             if(result.uploadedFile) {
						             	update_data(result.uploadedFile._id);
						             } else {
						             	alert('Please Upload Again, something has wrong')
						             	window.location.refresh;
						             }
						             
						        },
						        error: function(data)
						        {
						            console.log(data);
						            alert("some thing wrong , please try again");
						        }
						    });

						});
    </script>

  </body>

</html>
